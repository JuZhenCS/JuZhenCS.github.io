<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.5.0 -->
<title>ps2avrGB键盘刷QMK固件 | Ju,Zhen’s Blog</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="ps2avrGB键盘刷QMK固件" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="ps2avrGB键盘刷QMK固件 先聊点题外话，鬼知道为什么我就进了客制化的大坑。 如果是新人，请记得我的经验：客制化不省钱！客制化让键盘适应你，而不是你适应键盘！ ps2avrGB是韩国人开发的主控套件，国内也有很多人用这个做了定制化的开发，比如麦田外设的板子。（pcb上有mt字样） ps2avrGB的官方刷板应用是BootmapperClient，github上luizribeiro为它做了qmk的适配。 qmk顶顶大名，就不用多介绍了，基于chibiOS系统，支持模拟鼠标，可以一键进入刷机模式。总之功能特别强大！ 没错！你的键盘里跑着一个操作系统！！！还能代替鼠标！！！ 我买的是麦田的白色pcb的gh60板子，所以我只能以这个为例，记录下刷板子的过程。 我的板子没上灯，所以关于灯光的设置都没有，如果你看得懂qmk文档可以自己加灯光配置。 本文会默认读者已经有了一定的动手能力。毕竟你都搞客制化了，哪有纯菜鸟会玩这个？对吧。 本文会默认读者能读懂英文教程，别怕，翻译软件站在你身后！" />
<meta property="og:description" content="ps2avrGB键盘刷QMK固件 先聊点题外话，鬼知道为什么我就进了客制化的大坑。 如果是新人，请记得我的经验：客制化不省钱！客制化让键盘适应你，而不是你适应键盘！ ps2avrGB是韩国人开发的主控套件，国内也有很多人用这个做了定制化的开发，比如麦田外设的板子。（pcb上有mt字样） ps2avrGB的官方刷板应用是BootmapperClient，github上luizribeiro为它做了qmk的适配。 qmk顶顶大名，就不用多介绍了，基于chibiOS系统，支持模拟鼠标，可以一键进入刷机模式。总之功能特别强大！ 没错！你的键盘里跑着一个操作系统！！！还能代替鼠标！！！ 我买的是麦田的白色pcb的gh60板子，所以我只能以这个为例，记录下刷板子的过程。 我的板子没上灯，所以关于灯光的设置都没有，如果你看得懂qmk文档可以自己加灯光配置。 本文会默认读者已经有了一定的动手能力。毕竟你都搞客制化了，哪有纯菜鸟会玩这个？对吧。 本文会默认读者能读懂英文教程，别怕，翻译软件站在你身后！" />
<link rel="canonical" href="/jekyll/update/2018/01/26/blog.html" />
<meta property="og:url" content="/jekyll/update/2018/01/26/blog.html" />
<meta property="og:site_name" content="Ju,Zhen’s Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-01-26T07:31:52+00:00" />
<script type="application/ld+json">
{"description":"ps2avrGB键盘刷QMK固件 先聊点题外话，鬼知道为什么我就进了客制化的大坑。 如果是新人，请记得我的经验：客制化不省钱！客制化让键盘适应你，而不是你适应键盘！ ps2avrGB是韩国人开发的主控套件，国内也有很多人用这个做了定制化的开发，比如麦田外设的板子。（pcb上有mt字样） ps2avrGB的官方刷板应用是BootmapperClient，github上luizribeiro为它做了qmk的适配。 qmk顶顶大名，就不用多介绍了，基于chibiOS系统，支持模拟鼠标，可以一键进入刷机模式。总之功能特别强大！ 没错！你的键盘里跑着一个操作系统！！！还能代替鼠标！！！ 我买的是麦田的白色pcb的gh60板子，所以我只能以这个为例，记录下刷板子的过程。 我的板子没上灯，所以关于灯光的设置都没有，如果你看得懂qmk文档可以自己加灯光配置。 本文会默认读者已经有了一定的动手能力。毕竟你都搞客制化了，哪有纯菜鸟会玩这个？对吧。 本文会默认读者能读懂英文教程，别怕，翻译软件站在你身后！","@type":"BlogPosting","url":"/jekyll/update/2018/01/26/blog.html","headline":"ps2avrGB键盘刷QMK固件","dateModified":"2018-01-26T07:31:52+00:00","datePublished":"2018-01-26T07:31:52+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"/jekyll/update/2018/01/26/blog.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="Ju,Zhen's Blog" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Ju,Zhen&#39;s Blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">ps2avrGB键盘刷QMK固件</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2018-01-26T07:31:52+00:00" itemprop="datePublished">Jan 26, 2018
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h3 id="ps2avrgb键盘刷qmk固件">ps2avrGB键盘刷QMK固件</h3>
<blockquote>
  <p>先聊点题外话，鬼知道为什么我就进了客制化的大坑。<br />
如果是新人，请记得我的经验：<strong>客制化不省钱！客制化让键盘适应你，而不是你适应键盘！</strong><br />
ps2avrGB是韩国人开发的主控套件，国内也有很多人用这个做了定制化的开发，比如麦田外设的板子。（pcb上有mt字样）<br />
ps2avrGB的官方刷板应用是BootmapperClient，github上luizribeiro为它做了qmk的适配。<br />
qmk顶顶大名，就不用多介绍了，基于chibiOS系统，支持模拟鼠标，可以一键进入刷机模式。总之功能特别强大！<br />
<strong>没错！你的键盘里跑着一个操作系统！！！还能代替鼠标！！！</strong><br />
我买的是麦田的白色pcb的gh60板子，所以我只能以这个为例，记录下刷板子的过程。<br />
我的板子没上灯，所以关于灯光的设置都没有，如果你看得懂qmk文档可以自己加灯光配置。<br />
本文会默认读者已经有了一定的动手能力。毕竟你都搞客制化了，哪有纯菜鸟会玩这个？对吧。<br />
本文会默认读者能读懂英文教程，别怕，翻译软件站在你身后！</p>
</blockquote>

<p><strong>动手前请先看下全文，如果大多看不懂，请不要操作，键盘会变砖的！！！</strong><br />
<strong>动手前请先看下全文，如果大多看不懂，请不要操作，键盘会变砖的！！！</strong><br />
<strong>动手前请先看下全文，如果大多看不懂，请不要操作，键盘会变砖的！！！</strong><br />
如果真的发生的悲剧，键盘变砖，你可以在github上给qmk提issue，也可以邮件我，1312921719@qq.com。<br />
<strong>但是我不会对此负责，也不保证能帮助你修复键盘</strong><br />
<strong>今天是2018-01-26，如果时间过去太久这个教程可能已经失效了</strong></p>

<h4 id="刷板子准备">刷板子准备</h4>
<p>在刷板子之前需要做好如下的准备：</p>
<ul>
  <li>1.把github上的<a href="https://github.com/luizribeiro/qmk_firmware" title="luizribeiro的qmk">luizriberiro的qmk</a>项目clone到本地，并且配置好编译环境。</li>
  <li>2.下载BootmapperClient，最新的版本最好。</li>
  <li>3.找到进入键盘刷机模式(DFU模式)的方法。</li>
</ul>

<p>qmk的开发环境我是在ubuntu环境下搭建的，qmk有详细教程，只要搭建好编译环境就可以，不用管烧录工具。<br />
我的bootmapperClient版本是v0.10.0<br />
ps2avrGB进入刷机模式通常有两种：<br />
韩国的键盘是断开连接线，按住左ctrl或者U或者esc，然后再连接。<br />
一些国内客制化键盘是断开连接线，短接电路板上的两个接口，再连接。<br />
我的pcb是要短接电路板的，在电路板侧边缘有标p1的两个接口，我用镊子短接。<br />
一定注意<strong>不能</strong>用usb扩展口接键盘，电脑识别不出来的。<br />
进入刷机模式成功的标志就是连接电脑之后，键盘<strong>所有</strong>按键都没反应，变砖是部分按键没反应。</p>

<h3 id="生成刷机文件步骤">生成刷机文件步骤</h3>
<p>首先要修改qmk的代码以适配自己的键盘配列表。<br />
首先编辑config.h,适配键盘的配列。<br />
在#endif前添加如下内容：</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/* mouse settings*/</span>  <span class="c1">//定义模拟鼠标参数，单位毫秒  </span>
<span class="cp">#define MOUSEKEY_DELAY             150  //鼠标连续移动延迟，过大笨拙，过小发飘  
#define MOUSEKEY_INTERVAL          20  //鼠标刷新间隔  
#define MOUSEKEY_MAX_SPEED         2  //鼠标最大速度  
#define MOUSEKEY_TIME_TO_MAX       2  //鼠标到达最大速的时间  
#define MOUSEKEY_WHEEL_MAX_SPEED   2  //鼠标滚轮最大速度  
#define MOUSEKEY_WHEEL_TIME_TO_MAX 2  //鼠标滚轮到达最大速度的时间  
</span></code></pre></div></div>
<p>再编辑ps2avrGB.h文件，适配键盘的配列。<br />
在#endif前添加如下内容：</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#define MY_KEYMAP( \
  K31, K32, K33, K34, K35, K36, K37, K38, K39, K3A, K3B, K3C, K3D,      K3F, \
  K41, K42, K43, K44, K45, K46, K47, K48, K49, K4A, K4B, K4C, K4D, K4E,      \
  K51, K52, K53, K54, K55, K56, K57, K58, K59, K5A, K5B, K5C,      K5E,      \
  K61,      K63, K64, K65, K66, K67, K68, K69, K6A, K6B, K6C,      K6E,      \
  K71, K72, K73,                     K78,      K7A, K7B,      K7D, K7E       \
){ \
  { KC_NO, KC_NO, KC_NO, KC_NO, KC_NO, KC_NO, KC_NO, KC_NO, KC_NO, KC_NO, KC_NO, KC_NO, KC_NO, KC_NO, KC_NO }, \
  { KC_NO, KC_NO, KC_NO, KC_NO, KC_NO, KC_NO, KC_NO, KC_NO, KC_NO, KC_NO, KC_NO, KC_NO, KC_NO, KC_NO, KC_NO }, \
  { KC_NO, KC_NO, KC_NO, KC_NO, KC_NO, KC_NO, KC_NO, KC_NO, KC_NO, KC_NO, KC_NO, KC_NO, KC_NO, KC_NO, KC_NO }, \
  { K31,   K32,   K33,   K34,   K35,   K36,   K37,   K38,   K39,   K3A,   K3B,   K3C,   K3D,   KC_NO, K3F   }, \
  { K41,   K42,   K43,   K44,   K45,   K46,   K47,   K48,   K49,   K4A,   K4B,   K4C,   K4D,   K4E,   KC_NO }, \
  { K51,   K52,   K53,   K54,   K55,   K56,   K57,   K58,   K59,   K5A,   K5B,   K5C,   KC_NO, K5E,   KC_NO }, \
  { K61,   KC_NO, K63,   K64,   K65,   K66,   K67,   K68,   K69,   K6A,   K6B,   K6C,   KC_NO, K6E,   KC_NO }, \
  { K71,   K72,   K73,   KC_NO, KC_NO, KC_NO, KC_NO, K78,   KC_NO, K7A,   K7B,   KC_NO, K7D,   K7E,   KC_NO }  \
}
</span></code></pre></div></div>
<p>配置的方法其实挺简单的。格式如下：</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#define MY_KEYMAP( \
    K11, K12, K13, \
    K21,      K23  \
){ \
    { KC_11, KC_12, KC_13 }, \
    { KC_21, KC_NO, KC_23 }  \
}
</span></code></pre></div></div>
<p>上面的矩阵是我们的键盘轴排列方式，下面的矩阵是这些轴焊接在了哪里。<br />
比如我们设置了一个2x3的键盘矩阵，在上面焊了五个轴，排列如第一个矩阵。<br />
在第二个矩阵一一对应的，配置轴焊接的位置，没有焊轴的位置用NO占位。<br />
以上是我的怕pcb的布局，每个人习惯不同，布局都不同，可能需要微调。<br />
建立/root/qmk/qmk_firmware/keyboards/ps2avrGB/keymaps/mykeymap文件夹，最后的mykeymap可以任意改名。<br />
进入新建的文件夹，建立keymap.c文件。内容如下：</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include "ps2avrGB.h"
#include "action_layer.h"
#include "rgblight.h"
</span>
<span class="k">const</span> <span class="kt">uint16_t</span> <span class="n">PROGMEM</span> <span class="n">keymaps</span><span class="p">[][</span><span class="n">MATRIX_ROWS</span><span class="p">][</span><span class="n">MATRIX_COLS</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MY_KEYMAP</span><span class="p">(</span>
        <span class="n">KC_ESC</span><span class="p">,</span>  <span class="n">KC_1</span><span class="p">,</span>    <span class="n">KC_2</span><span class="p">,</span>    <span class="n">KC_3</span><span class="p">,</span>    <span class="n">KC_4</span><span class="p">,</span>    <span class="n">KC_5</span><span class="p">,</span>    <span class="n">KC_6</span><span class="p">,</span>    <span class="n">KC_7</span><span class="p">,</span>    <span class="n">KC_8</span><span class="p">,</span>    <span class="n">KC_9</span><span class="p">,</span>    <span class="n">KC_0</span><span class="p">,</span>    <span class="n">KC_MINS</span><span class="p">,</span> <span class="n">KC_EQL</span><span class="p">,</span>           <span class="n">KC_BSPC</span><span class="p">,</span>
        <span class="n">KC_TAB</span><span class="p">,</span>  <span class="n">KC_Q</span><span class="p">,</span>    <span class="n">KC_W</span><span class="p">,</span>    <span class="n">KC_E</span><span class="p">,</span>    <span class="n">KC_R</span><span class="p">,</span>    <span class="n">KC_T</span><span class="p">,</span>    <span class="n">KC_Y</span><span class="p">,</span>    <span class="n">KC_U</span><span class="p">,</span>    <span class="n">KC_I</span><span class="p">,</span>    <span class="n">KC_O</span><span class="p">,</span>    <span class="n">KC_P</span><span class="p">,</span>    <span class="n">KC_LBRC</span><span class="p">,</span> <span class="n">KC_RBRC</span><span class="p">,</span> <span class="n">KC_BSLS</span><span class="p">,</span>
        <span class="n">KC_LCTL</span><span class="p">,</span> <span class="n">KC_A</span><span class="p">,</span>    <span class="n">KC_S</span><span class="p">,</span>    <span class="n">KC_D</span><span class="p">,</span>    <span class="n">KC_F</span><span class="p">,</span>    <span class="n">KC_G</span><span class="p">,</span>    <span class="n">KC_H</span><span class="p">,</span>    <span class="n">KC_J</span><span class="p">,</span>    <span class="n">KC_K</span><span class="p">,</span>    <span class="n">KC_L</span><span class="p">,</span>    <span class="n">KC_SCLN</span><span class="p">,</span> <span class="n">KC_QUOT</span><span class="p">,</span>          <span class="n">KC_ENT</span><span class="p">,</span>
        <span class="n">KC_LSFT</span><span class="p">,</span>          <span class="n">KC_Z</span><span class="p">,</span>    <span class="n">KC_X</span><span class="p">,</span>    <span class="n">KC_C</span><span class="p">,</span>    <span class="n">KC_V</span><span class="p">,</span>    <span class="n">KC_B</span><span class="p">,</span>    <span class="n">KC_N</span><span class="p">,</span>    <span class="n">KC_M</span><span class="p">,</span>    <span class="n">KC_COMM</span><span class="p">,</span> <span class="n">KC_DOT</span><span class="p">,</span>  <span class="n">KC_SLSH</span><span class="p">,</span>          <span class="n">KC_FN0</span><span class="p">,</span>
        <span class="n">KC_FN1</span><span class="p">,</span>  <span class="n">KC_RGUI</span><span class="p">,</span> <span class="n">KC_LALT</span><span class="p">,</span>                                     <span class="n">KC_SPC</span><span class="p">,</span>           <span class="n">KC_FN2</span><span class="p">,</span>  <span class="n">KC_APP</span><span class="p">,</span>           <span class="n">KC_CAPS</span><span class="p">,</span> <span class="n">KC_INS</span>
    <span class="p">),</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">MY_KEYMAP</span><span class="p">(</span>
        <span class="n">KC_GRV</span><span class="p">,</span>  <span class="n">KC_F1</span><span class="p">,</span>   <span class="n">KC_F2</span><span class="p">,</span>   <span class="n">KC_F3</span><span class="p">,</span>   <span class="n">KC_F4</span><span class="p">,</span>   <span class="n">KC_F5</span><span class="p">,</span>   <span class="n">KC_F6</span><span class="p">,</span>   <span class="n">KC_F7</span><span class="p">,</span>   <span class="n">KC_F8</span><span class="p">,</span>   <span class="n">KC_F9</span><span class="p">,</span>   <span class="n">KC_F10</span><span class="p">,</span>  <span class="n">KC_F11</span><span class="p">,</span>  <span class="n">KC_F12</span><span class="p">,</span>           <span class="n">KC_DEL</span><span class="p">,</span>
        <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_PGUP</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span>
        <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_HOME</span><span class="p">,</span> <span class="n">KC_PGDN</span><span class="p">,</span> <span class="n">KC_END</span><span class="p">,</span>  <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span>          <span class="n">KC_TRNS</span><span class="p">,</span>
        <span class="n">KC_TRNS</span><span class="p">,</span>          <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span>          <span class="n">KC_TRNS</span><span class="p">,</span>
        <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span>                                     <span class="n">KC_TRNS</span><span class="p">,</span>          <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span>          <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span>
    <span class="p">),</span>
    <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">MY_KEYMAP</span><span class="p">(</span>
        <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span>          <span class="n">KC_TRNS</span><span class="p">,</span>
        <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span>
        <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_LEFT</span><span class="p">,</span> <span class="n">KC_DOWN</span><span class="p">,</span> <span class="n">KC_UP</span><span class="p">,</span>   <span class="n">KC_RGHT</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span>          <span class="n">KC_TRNS</span><span class="p">,</span>
        <span class="n">KC_TRNS</span><span class="p">,</span>          <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span>          <span class="n">KC_TRNS</span><span class="p">,</span>
        <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span>                                     <span class="n">KC_TRNS</span><span class="p">,</span>          <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span>          <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span>
    <span class="p">),</span>
    <span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">MY_KEYMAP</span><span class="p">(</span>
        <span class="n">RESET</span><span class="p">,</span>   <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span>          <span class="n">KC_TRNS</span><span class="p">,</span>
        <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_WH_U</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_MS_U</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span>
        <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_BTN2</span><span class="p">,</span> <span class="n">KC_WH_D</span><span class="p">,</span> <span class="n">KC_BTN1</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_MS_L</span><span class="p">,</span> <span class="n">KC_MS_D</span><span class="p">,</span> <span class="n">KC_MS_R</span><span class="p">,</span>          <span class="n">KC_TRNS</span><span class="p">,</span>
        <span class="n">KC_TRNS</span><span class="p">,</span>          <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span>          <span class="n">KC_TRNS</span><span class="p">,</span>
        <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span>                                     <span class="n">KC_TRNS</span><span class="p">,</span>          <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span><span class="p">,</span>          <span class="n">KC_TRNS</span><span class="p">,</span> <span class="n">KC_TRNS</span>
    <span class="p">),</span>
<span class="p">};</span>

<span class="k">const</span> <span class="kt">uint16_t</span> <span class="n">PROGMEM</span> <span class="n">fn_actions</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
  <span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="o">=</span> <span class="n">ACTION_LAYER_MOMENTARY</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
  <span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="o">=</span> <span class="n">ACTION_LAYER_MOMENTARY</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
  <span class="p">[</span><span class="mi">2</span><span class="p">]</span>  <span class="o">=</span> <span class="n">ACTION_LAYER_MOMENTARY</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
<span class="p">};</span>
</code></pre></div></div>
<p>这里的键位设置是和ps2avrGB.h里的设置对应的。应该很容易看懂。<br />
默认键盘在第0层状态，按下FN0键进入第一层，按下FN1进入第二层，以此类推。<br />
KC_TRNS表示透明，比如字母K键。按下FN1和K键，从第0层进入第2层，KC_TRNS会透明映射到下面第0层，输出还是K。<br />
KC_MS_L就是鼠标模拟向左移动，具体的keycode可以参考<a href="https://docs.qmk.fm/keycodes.html" title="qmk的keycoede文档">qmk的keycode文档</a>。<br />
第三层的左上角RESET键表示进入刷机(DFU)模式，有了这个键就不用每次都短接了。<br />
最后回到qmk_firmware,执行下面的命令：</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make ps2avrGB
</code></pre></div></div>
<p>大概会有一个这样的回显：</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Making ps2avrGB with keymap default <span class="o">[</span>OK]
Making ps2avrGB with keymap luizribeiro <span class="o">[</span>OK]
Making ps2avrGB with keymap mykeyboard <span class="o">[</span>OK]
</code></pre></div></div>
<p>成功之后会生成ps2avrGB_mykeyboard.hex文件，就是我们的目标文件了。</p>
<h4 id="刷板子步骤">刷板子步骤</h4>
<p>刷板子我是在windows平台上进行的，linux当然也可以，不过我没成功。<br />
通过按键或者短接，让键盘的板子进入刷机模式，连接电脑，打开bootmapperClient。<br />
右上角选option，左下角的utils里点firm up，弹出的窗口中选中ps2avrGB_mykeyboard.hex，刷机开始。<br />
没问题的话会弹出一个对话框，在跑马灯显示一堆二进制地址，不到10秒对话框消失，刷机完成。<br />
如果刷机成功，以后再刷的时候按reset键就可以进去刷机模式了，不用每次都短接。<br />
第一次配列肯定是会有问题的，用一段时间发现不方便再改，慢慢你的键盘就会进化出最适合你的配列。</p>
<h4 id="可能会遇到的问题">可能会遇到的问题</h4>
<p>可能会遇到的最大的问题就是运气问题，我的板子变砖过，连上电脑不识别过。<br />
装驱动把其他设备驱动装坏过，编译debug一天没成果过。<br />
不过基本都是因为小问题，运气好的话是不会遇到的。<br />
运气不好的话，恭喜你！因为专家就是把能遇到的问题都遇到了一遍的人。</p>

  </div><a class="u-url" href="/jekyll/update/2018/01/26/blog.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Ju,Zhen&#39;s Blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Ju,Zhen&#39;s Blog</li><li><a class="u-email" href="mailto:1312921719@qq.com">1312921719@qq.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/JuZhenCS"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">JuZhenCS</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>This is Ju,Zhen&#39;s blog, which mainly records some technical articles. Some thoughts will also be recorded.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
